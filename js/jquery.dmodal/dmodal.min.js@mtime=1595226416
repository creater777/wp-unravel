$.dmodal=function(t){function o(o){27==o.keyCode&&t.allowClose&&p.trigger("dmodal-close"),t.keycontrol(o,p)}t=$.extend(!0,{allowClose:!0,closeButton:!0,close:function(){},keycontrol:function(t,o){},callback:function(t){var o=$("<div />").appendTo(t);return o}},t);var a=$(".dsticky");a.each(function(){$(this).attr("data-top",$(this).cssv("top")).css({top:"auto"})});var d=$("body"),n=$(window).scrollTop(),e=d.children().not(".cke, .cke_screen_reader_only"),i=$("<div />").addClass("dmodal-html-clone").appendTo(d),l=$("<div />").addClass("dmodal-body-clone").css({top:-n,paddingTop:d.cssv("padding-top"),paddingRight:d.cssv("padding-right"),paddingbottom:d.cssv("padding-bottom"),paddingLeft:d.cssv("padding-left"),marginTop:d.cssv("margin-top"),marginRight:d.cssv("margin-right"),marginbottom:d.cssv("margin-bottom"),marginLeft:d.cssv("margin-left")}).appendTo(i);e.appendTo(l),$(window).scrollTop(0);var r=$("<div />").addClass("dmodal-wrap").appendTo(d),s=($("<div />").addClass("dmodal-birdscreen").appendTo(r),$("<div />").addClass("dmodal-outer").appendTo(r)),c=$("<div />").addClass("dmodal-inner").appendTo(s).click(function(o){t.allowClose&&o.originalEvent&&p.trigger("dmodal-close")}),p=$("<div />").addClass("dmodal-container").appendTo(c).bind("dmodal-close",function(e){$(document).unbind("keyup",o),i.removeClass("active-"),r.removeClass("active-"),setTimeout(function(){t.close(),r.remove(),l.children().prependTo(d),i.remove(),$(window).scrollTop(n)},$("html").hasClass("csstransitions")?600:0),a.each(function(){$(this).css({top:$(this).attr("data-top")})})}),g=t.callback(p).click(function(t){t.stopPropagation(),$("html").trigger("click.Outside",t)});if(g.find("a.pjax").click(function(t){t.preventDefault(),t.stopPropagation(),$.pjaxRedirect($(this).attr("href"))}),setTimeout(function(){i.addClass("active-"),r.addClass("active-")},0),t.closeButton){$("<button />").attr("type","button").addClass("dmodal-close").appendTo(g).focus(function(){$(this).blur()}).click(function(t){t.preventDefault(),p.trigger("dmodal-close")})}return $(document).keyup(o),p},$.dmodalLoading=function(t){return t=$.extend(!0,{allowClose:!1,closeButton:!1,callback:function(t){return t.css("background","url(/img/loading-large-eee.gif) no-repeat center"),$()}},t),$.dmodal(t)},$.fn.dmodalTrigger=function(t){return this.click(function(t){function o(t,o,a){$.dmodal({close:function(){"function"==typeof a&&a(t)},callback:function(a){return t.addClass("dmodal-content").appendTo(a),"function"==typeof o&&o(t),t.trigger("dmodal-callback"),t.find("a.dmodal-trigger").click(function(t){t.preventDefault(),a.trigger("dmodal-close")}),t}})}t.preventDefault();var a=$(this),d=a.attr("href");if(!a.hasClass("dmodal-trigger-ing"))if(d.match(/^#/)){var n=$($(this).attr("href"));if(n.length>0){var e=$("<div />").hide().insertAfter(n);n.removeClass("hide"),o(n,function(){},function(){n.addClass("hide").insertBefore(e),e.remove()})}}else a.addClass("dmodal-trigger-ing"),$.get(d,function(t){a.removeClass("dmodal-trigger-ing");var d=$("<div />").html(t);a.attr("data-selector")&&(d=d.find(a.attr("data-selector"))),o(d,function(t){t.dofirst()})},"html")})},$(document).bind("dofirst",function(t,o){$(o).find("a.dmodal-trigger").dmodalTrigger()});