$.fn.dcomment=function(t){return this.each(function(){function a(n){c.show(),$.post(t.url+"/limit/"+n,function(n){c.hide(),$(n.rows).each(function(){d(this)}),t.permCreate&&0==m.find(".dcomment-form").length&&(r(m,null),location.hash.match(/^#comment-[0-9]+$/)&&$(location.hash).each(function(){var t=$(this);$("html, body").animate({scrollTop:t.offset().top}),t.addClass("blink"),setTimeout(function(){t.removeClass("blink")},3e3)})),n.pagination.total_pages>1?$("<a />").attr("href","#").html('<span class="fa fa-comment-o"></span> '+t.txtMoreComments).appendTo(i.show()).click(function(t){t.preventDefault(),a(0)}):i.empty().hide()},"json")}function n(t){return $("#comment-"+t.uid).length>0?null:$("<div />").attr("id","comment-"+t.uid).addClass("dcomment-row list-group-item")}function d(t){var a=n(t);a&&s(a.prependTo(l),t)}function o(t){var a=n(t);a&&s(a.appendTo(l),t)}function e(t,a,n,d){var o=$("<div />").addClass("row").html("<hr />").appendTo(a),e=$("<div />").addClass("col s8 offset-s2 m6 offset-m3").appendTo(o),s=$("<form />").attr("method","post").attr("action",t).appendTo(e);$('<input type="hidden" name="mode" value="password" />').appendTo(s);var r=$("<div />").addClass("input-group").appendTo(s);$("<div />").addClass("input-group-addon").html('<span class="fa fa-fw fa-lock"></span>').appendTo(r),$("<input />").attr("type","password").attr("name","password").attr("placeholder","비밀번호").appendTo(r).focus();var p=$("<div />").addClass("input-group-btn").appendTo(r);$("<button />").html('<span class="fa fa-fw fa-check"></span>').addClass("btn btn-secondary").appendTo(p),s.dform({submit:function(){return d(s)}})}function s(a,n){a.empty();var d,o=($("<div />").addClass("dcomment-author pull-left").text(n.name).appendTo(a),$("<div />").addClass("dcomment-body").html(n.body).appendTo(a),$("<div />").addClass("dcomment-info").appendTo(a));$("<span />").addClass("dcore-info-item").html('<span class="fa fa-clock-o"></span> '+n.time).appendTo(o),n.perm_update&&(d=$("<span />").addClass("dcore-info-item func").appendTo(o),$("<a />").attr("href","#").html('<span class="fa fa-pencil-square-o"></span>').attr("data-tooltip",t.txtBtnEdit).tooltip().click(function(d){function s(d){return d.error?void $.dtoast(d.error):(d.row.body=$("<div />").html(d.row.body).text(),r(a,d.row),!t.islogin&&"0"==n.uid_user&&d.row.password&&a.find('input[name="password"]').val(d.row.password).parent().hide(),void a.find("textarea").focus().select())}d.preventDefault();var p=t.url+"/"+n.uid+"/update";t.islogin||"0"!=n.uid_user?(c.show(),$.get(p,function(t){c.hide(),s(t)},"json")):(o.hide(),e(p,a,n,function(t){return c.show(),$.post(t.attr("action"),t.serialize(),function(t){c.hide(),s(t)},"json"),!1}))}).appendTo(d)),n.perm_delete&&(d=$("<span />").addClass("dcore-info-item func").appendTo(o),$("<a />").attr("href","#").html('<span class="fa fa-trash-o"></span>').attr("data-tooltip",t.txtBtnDelete).tooltip().click(function(d){function s(t){"__OK__"!=t?$.dtoast(t):a.remove()}d.preventDefault();var r=t.url+"/"+n.uid+"/delete";t.islogin||"0"!=n.uid_user?$.dconfirm(t.txtMsgDelete,function(){c.show(),$.post(r,function(t){c.hide(),s(t)})}):(o.hide(),e(r,a,n,function(t){return c.show(),$.post(t.attr("action"),t.serialize(),function(t){c.hide(),s(t)},"text"),!1}))}).appendTo(d))}function r(a,n){a.empty();var d,e,p,i,l,m=$("<div />").addClass("dcomment-form").appendTo(a),u=$("<form />").attr("method","post").attr("action",t.url+(n?"/"+n.uid+"/update":"/create")).appendTo(m);d=$("<div />").addClass("form-group").appendTo(u);var f=$("<textarea />").attr("name","body").attr("rows","1").attr("cols","80").attr("placeholder",t.txtCommentsBody).val(n?n.body:"").appendTo(d).dform().dformTextareaAutoHeight();if(i=$("<div />").addClass("row").appendTo(u),!t.islogin){l=$("<div />").addClass("col s4").appendTo(i),d=$("<div />").addClass("form-group").appendTo(l),e=$("<div />").addClass("input-group").appendTo(d),p=$("<div />").addClass("input-group-addon").appendTo(e),$("<span />").addClass("fa fa-user").appendTo(p);$("<input />").attr("type","text").attr("name","name").attr("maxlength","255").attr("placeholder",t.txtAuthor).val(n?n.name:"").appendTo(e).dform();l=$("<div />").addClass("col s4").appendTo(i),d=$("<div />").addClass("form-group").appendTo(l),e=$("<div />").addClass("input-group").appendTo(d),p=$("<div />").addClass("input-group-addon").appendTo(e),$("<span />").addClass("fa fa-lock").appendTo(p);$("<input />").attr("type","password").attr("name","password").attr("maxlength","255").attr("placeholder",t.txtPassword).appendTo(e).dform()}l=$("<div />").addClass(t.islogin?"col s12 right-align":"col s2").appendTo(i);var h=$("<button />").attr("type","button").html('<span class="fa fa-times"></span> '+t.txtBtnCancel).addClass("btn btn-secondary"+(t.islogin?" btn-sm":" btn-block")).appendTo(l).dform();t.islogin?l.append(" "):l=$("<div />").addClass("col s2").appendTo(i);var x=$("<button />").attr("type","submit").html(n?'<span class="fa fa-check"></span> '+t.txtBtnApply:'<span class="fa fa-check"></span> '+t.txtBtnPost).addClass("btn btn-primary"+(t.islogin?" btn-sm":" btn-block")).appendTo(l).dform();i.hide(),f.focus(function(){i.show()}),h.click(function(t){t.preventDefault(),n?s(a,n):r(a,null)}),u.dform({submit:function(){return c.show(),x.prop("disabled",!0),$.post(u.attr("action"),u.serialize(),function(t){c.hide(),n?s(a,t.row):(o(t.row),r(a,n))},"json"),!1}})}var p=$(this);if(!p.hasClass("dcomment-installed")){t=$.extend({txtAuthor:"",txtBtnApply:"",txtBtnCancel:"",txtBtnDelete:"",txtBtnEdit:"",txtBtnPost:"",txtCommentsBody:"",txtMoreComments:"",txtMsgDelete:"",txtPassword:"",url:"",islogin:!1,permCreate:!0,limit:4},t,!0),p.empty().addClass("dcomment dcomment-installed");var i=$("<div />").addClass("dcomment-more").appendTo(p).hide(),l=$("<div />").addClass("dcomment-rows list-group").appendTo(p),m=$("<div />").addClass("dcomment-forms").appendTo(p),c=$("<div />").addClass("dcomment-loading").appendTo(p).hide();$("<div />").addClass("screen").appendTo(c),$("<div />").addClass("spinner").appendTo(c).spin(),p.attr("data-txt-author")&&(t.txtAuthor=p.attr("data-txt-author")),p.attr("data-txt-btn-apply")&&(t.txtBtnApply=p.attr("data-txt-btn-apply")),p.attr("data-txt-btn-cancel")&&(t.txtBtnCancel=p.attr("data-txt-btn-cancel")),p.attr("data-txt-btn-delete")&&(t.txtBtnDelete=p.attr("data-txt-btn-delete")),p.attr("data-txt-btn-edit")&&(t.txtBtnEdit=p.attr("data-txt-btn-edit")),p.attr("data-txt-btn-post")&&(t.txtBtnPost=p.attr("data-txt-btn-post")),p.attr("data-txt-comments-body")&&(t.txtCommentsBody=p.attr("data-txt-comments-body")),p.attr("data-txt-more-comments")&&(t.txtMoreComments=p.attr("data-txt-more-comments")),p.attr("data-txt-msg-delete")&&(t.txtMsgDelete=p.attr("data-txt-msg-delete")),p.attr("data-txt-password")&&(t.txtPassword=p.attr("data-txt-password")),p.attr("data-url")&&(t.url=p.attr("data-url")),p.attr("data-islogin")&&(t.islogin="true"==p.attr("data-islogin")),p.attr("data-perm-create")&&(t.permCreate="true"==p.attr("data-perm-create")),p.attr("data-limit")&&(t.limit=parseInt(p.attr("data-limit"))),t.url&&a(t.limit)}})},$(document).bind("dofirst",function(t,a){$(a).find(".dcomment").dcomment()});